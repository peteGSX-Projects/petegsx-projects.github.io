<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Programming &mdash; Pete&#39;s Pages  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Rokuhan DCC Turnout Controller" href="../rokuhan-turnout-control/index.html" />
    <link rel="prev" title="Software and Logic" href="software.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Pete's Pages
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmable DCC Turntable Controller</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware.html">Hardware components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#arduino-uno">Arduino Uno</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#uln2003-28byj-48-stepper-driver-and-motor">ULN2003/28BYJ-48 stepper driver and motor</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#hall-effect-sensor">Hall effect sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#dual-relay-board">Dual relay board</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#prototype-shield">Prototype shield</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#power-supply-voltage-regulator">Power supply/voltage regulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="hardware.html#dcc-decoder-circuit">DCC Decoder circuit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="software.html">Software and Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="software.html#startup">Startup</a></li>
<li class="toctree-l3"><a class="reference internal" href="software.html#in-action">In action</a></li>
<li class="toctree-l3"><a class="reference internal" href="software.html#error-checking">Error checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="software.html#decoder-base-address">Decoder base address</a></li>
<li class="toctree-l3"><a class="reference internal" href="software.html#position-definitions">Position definitions</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Programming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base-decoder-address">Base decoder address</a></li>
<li class="toctree-l3"><a class="reference internal" href="#turntable-positions">Turntable positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-mode-programming">Service mode programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ops-mode-programming-program-on-main-pom">Ops mode programming (Program on Main/POM)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rokuhan-turnout-control/index.html">Rokuhan DCC Turnout Controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rokuhan-turnout-control/overview.html">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#instructions">Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#arduino-pins">Arduino pins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#dcc-pins">DCC pins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#turnout-1-pins-connect-to-first-l293d">Turnout 1 pins - connect to first L293D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#point-2-pins-connect-to-first-l293d">Point 2 pins - connect to first L293D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#point-3-pins-connect-to-second-l293d">Point 3 pins - connect to second L293D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rokuhan-turnout-control/overview.html#point-4-pins-connect-to-second-l293d">Point 4 pins - connect to second L293D</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pete's Pages</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Programmable DCC Turntable Controller</a> &raquo;</li>
      <li>Programming</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/turntable-controller/programming.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="programming">
<h1>Programming<a class="headerlink" href="#programming" title="Permalink to this heading"></a></h1>
<p>The turntable will require programming of both the base decoder address to respond to as well as the turntable positions.</p>
<section id="base-decoder-address">
<h2>Base decoder address<a class="headerlink" href="#base-decoder-address" title="Permalink to this heading"></a></h2>
<p>The base decoder address is made up of the 6 least significant bits in CV 1 (cvLSB), and the 3 least significant bits in CV 9 (cvMSB).</p>
<p>I happen to run my turntable with a base address of 201, which requires CV 1 to be set to 51 and CV 9 to be set to 0.</p>
<p>The formula to calculate this is: (((cvMSB * 64) + cvLSB - 1) * 4) + 1</p>
<p>In my case, this translates to: (((0 * 64) + 51 - 1) * 4) + 1 = 201</p>
<p>This formula originates from having a DCC accessory board being capable of driving four outputs.</p>
</section>
<section id="turntable-positions">
<h2>Turntable positions<a class="headerlink" href="#turntable-positions" title="Permalink to this heading"></a></h2>
<p>The turntable positions are defined in the manufacturer reserved CVs starting at 513 as per the NMRA standard.</p>
<p>CV 513 contains the number of positions being defined, with a valid maximum of 50 positions available.</p>
<p>Each position definition requires three CVs to be programmed starting at CV 514:</p>
<p>The least significant bits (LSB) of the steps to be moved for the defined position.
The most significant bits (MSB) of the steps to be moved for the defined position.
The polarity flag for the defined position (0 for retain existing, 1 to reverse polarity).
The code performs an 8 bit left shift on the MSB before adding the LSB to determine the number of steps for the position.</p>
<p>This is an example table for a six position turntable definition:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 19%" />
<col style="width: 9%" />
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Position</p></th>
<th class="head"><p>DCC Address</p></th>
<th class="head"><p>Steps from Home</p></th>
<th class="head"><p>LSB CV</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>MSB CV</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Polarity CV</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>201</p></td>
<td><p>12</p></td>
<td><p>514</p></td>
<td><p>12</p></td>
<td><p>515</p></td>
<td><p>0</p></td>
<td><p>516</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>202</p></td>
<td><p>42</p></td>
<td><p>517</p></td>
<td><p>42</p></td>
<td><p>518</p></td>
<td><p>0</p></td>
<td><p>519</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>203</p></td>
<td><p>126</p></td>
<td><p>520</p></td>
<td><p>126</p></td>
<td><p>521</p></td>
<td><p>0</p></td>
<td><p>522</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>204</p></td>
<td><p>210</p></td>
<td><p>523</p></td>
<td><p>210</p></td>
<td><p>524</p></td>
<td><p>0</p></td>
<td><p>525</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>205</p></td>
<td><p>1122</p></td>
<td><p>526</p></td>
<td><p>98</p></td>
<td><p>527</p></td>
<td><p>4</p></td>
<td><p>528</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>206</p></td>
<td><p>1164</p></td>
<td><p>529</p></td>
<td><p>140</p></td>
<td><p>530</p></td>
<td><p>4</p></td>
<td><p>531</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="service-mode-programming">
<h2>Service mode programming<a class="headerlink" href="#service-mode-programming" title="Permalink to this heading"></a></h2>
<p>The typical way of programming decoders is to connect them to a programming track which allows for service mode programming.</p>
<p>The NmraDcc library enables this functionality, so programming in service mode is as straight forward as connecting to the programming track and performing the programming activities.</p>
<p>I use the JMRI single CV programmer for these activities.</p>
<p>I’d recommend using service mode programming to set both the decoder base address and the ops mode address. Defining the turntable positions can be done in either service mode or ops mode once these are set.</p>
</section>
<section id="ops-mode-programming-program-on-main-pom">
<h2>Ops mode programming (Program on Main/POM)<a class="headerlink" href="#ops-mode-programming-program-on-main-pom" title="Permalink to this heading"></a></h2>
<p>I found it important to incorporate the ability to perform ops mode programming once the turntable is permanently in place to have a simple method of making adjustments to the defined positions in order to get track alignment for each position as accurate as possible and to allow for any variations once the home sensor is mounted permanently.</p>
<p>In order to enable ops mode programming, the DCC library needs to have a CV provided that contains the DCC decoder address to respond to for programming commands.</p>
<p>To facilitate this, the manufacturer reserved CV 112 is used to contain the DCC decoder address, and I simply program CV 112 with the same address as the base address for the turntable (201 in my case).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="software.html" class="btn btn-neutral float-left" title="Software and Logic" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../rokuhan-turnout-control/index.html" class="btn btn-neutral float-right" title="Rokuhan DCC Turnout Controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, peteGSX.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>